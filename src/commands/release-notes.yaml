# src/commands/release.yaml

description: |
  Generate release notes using github-release-notes.

  Dependencies:
  - expects GREN_GITHUB_TOKEN
  - use extra-release-args tp customize default behavior
  - use .grenrc to customize release behavior
  - changelog behavior not supported 

parameters:

  release:
    description: generate release notes
    type: boolean
    default: true

  on-tag:
    description: generate release notes based on changes between last ne previous tag
    type: boolean
    default: false

  extra-release-args:
    description: Extra flags to pass to gren
    type: string
    default: ""

  before-release:
    description: Optional steps to run prior to gren release.
    type: steps
    default: []

steps:
  - when:
      name: Run before-release lifecycle hook steps.
      condition: << parameters.before-release >>
      steps: << parameters.before-release >>
  - when:
      condition: << parameters.release >>
      steps:
        - run:
            name: generate release github-release-notes
            command: gren release <<#parameters.on-tag>>-t $CIRCLE_TAG<</parameters.on-tag>> <<#parameters.extra-release-args>><<parameters.extra-release-args>><</parameters.extra-release-args>>
  - unless:
        condition: << parameters.release >>
        steps:
          - run:
              name: generate change log
              command: gren changelog <<#parameters.extra-release-args>><<parameters.extra-release-args>><</parameters.extra-release-args>>

