# src/commands/lint.yaml

description: run Hadolint against Dockerfile

parameters:

  lint-using-docker:
    description: Hadolint not installed on executor build agent, run hadolint docker image to perform test
    type: boolean
    default: true

  dockerfile:
    description: Name of dockerfile
    type: string
    default: Dockerfile

  registry:
    description: Support for alternative or private registry
    type: string
    default: docker.io

  image:
    description: Support for alternative image
    type: string
    default: hadolint/hadolint

  tag:
    description: Support for specific image version tag
    type: string
    default: ""

steps:
  - when:
      condition: << parameters.lint-using-docker >>
      name: use hadolint docker image to line Dockerfile
      steps:
        - run: docker run --rm -i << parameters.registry >>/<< parameters.image >><<#parameters.tag>>:<<parameters.tag>><</parameters.tag>> < << parameters.dockerfile >>
  - unless:
      condition: << parameters.lint-using-docker >>
      name: use hadolint installed on executor
      steps:
        - run: hadolint << parameters.dockerfile >>
